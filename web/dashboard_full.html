<!DOCTYPE html>
<html lang="en">
<head>
	<title>NetData Dashboard</title>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="author" content="costa@tsaousis.gr">
	<style>

	/* prevent body from hidding under the navbar */
	body {
		padding-top: 50px;
	}

	/* fix # anchors scrolling under the navbar
	   https://github.com/twbs/bootstrap/issues/1768#issuecomment-46519033
	 */
	h1 {
		position: relative;
		z-index: -1;
	}
	h2 {
		position: relative;
		z-index: -2;
	}
	h1:before, h2:before { 
		display: block; 
		content: " "; 
		margin-top: -70px;
		height: 70px;
		visibility: hidden; 
	}

	.chart-message {
		display: block; 
		margin-top: 10px;
	}

	.container {
		width: 90% !important;
	}

	#masthead h1 {
		/*font-size: 30px;*/
		line-height: 1;
		padding-top: 30px;
	}

	#masthead .well {
		margin-top:4%;
	}


	/*
	 * Side navigation
	 *
	 * Scrollspy and affixed enhanced navigation to highlight sections and secondary
	 * sections of docs content.
	 */

	.dashboard-sidebar {
		max-height: calc(100% - 70px) !important;
		overflow-y: auto;
		width: 170px !important;
	}

	/* By default it's not affixed in mobile views, so undo that */
	.dashboard-sidebar.affix {
		position: static;
	}
	@media (min-width: 768px) {
		.dashboard-sidebar {
			padding-left: 20px;
		}
	}

	.affix {
		position: static;
		top: 70px !important;
		width: 170px;
	}
	.affix-top {
		width: 170px;
	}

	/* First level of nav */
	.dashboard-sidenav {
		margin-top: 20px;
		margin-bottom: 20px;
	}

	/* All levels of nav */
	.dashboard-sidebar .nav > li > a {
		display: block;
		padding: 4px 20px;
		font-size: 13px;
		font-weight: 500;
		color: #767676;
	}
	.dashboard-sidebar .nav > li > a:hover,
	.dashboard-sidebar .nav > li > a:focus {
		padding-left: 19px;
		color: #563d7c;
		text-decoration: none;
		background-color: transparent;
		border-left: 1px solid #563d7c;
	}
	.dashboard-sidebar .nav > .active > a,
	.dashboard-sidebar .nav > .active:hover > a,
	.dashboard-sidebar .nav > .active:focus > a {
		padding-left: 18px;
		font-weight: bold;
		color: #563d7c;
		background-color: transparent;
		border-left: 2px solid #563d7c;
	}

	/* Nav: second level (shown on .active) */
	.dashboard-sidebar .nav .nav {
		display: none; /* Hide by default, but at >768px, show it */
		padding-bottom: 10px;
	}
	.dashboard-sidebar .nav .nav > li > a {
		padding-top: 1px;
		padding-bottom: 1px;
		padding-left: 30px;
		font-size: 12px;
		font-weight: normal;
	}
	.dashboard-sidebar .nav .nav > li > a:hover,
	.dashboard-sidebar .nav .nav > li > a:focus {
		padding-left: 29px;
	}
	.dashboard-sidebar .nav .nav > .active > a,
	.dashboard-sidebar .nav .nav > .active:hover > a,
	.dashboard-sidebar .nav .nav > .active:focus > a {
		padding-left: 28px;
		font-weight: 500;
	}

	/* Back to top (hidden on mobile) */
	.back-to-top,
	.dashboard-theme-toggle {
		display: none;
		padding: 4px 10px;
		margin-top: 10px;
		margin-left: 10px;
		font-size: 12px;
		font-weight: 500;
		color: #999;
	}
	.back-to-top:hover,
	.dashboard-theme-toggle:hover {
		color: #563d7c;
		text-decoration: none;
	}
	.dashboard-theme-toggle {
		margin-top: 0;
	}

	@media (min-width: 768px) {
		.back-to-top,
		.dashboard-theme-toggle {
			display: block;
		}
	}

	/* Show and affix the side nav when space allows it */
	@media (min-width: 992px) {
		.dashboard-sidebar .nav > .active > ul {
			display: block;
		}
		/* Widen the fixed sidebar */
		.dashboard-sidebar.affix,
		.dashboard-sidebar.affix-bottom {
			width: 213px;
		}
		.dashboard-sidebar.affix {
			position: fixed; /* Undo the static from mobile first approach */
			top: 20px;
		}
		.dashboard-sidebar.affix-bottom {
			position: absolute; /* Undo the static from mobile first approach */
		}
		.dashboard-sidebar.affix-bottom .dashboard-sidenav,
		.dashboard-sidebar.affix .dashboard-sidenav {
			margin-top: 0;
			margin-bottom: 0;
		}
	}
	@media (min-width: 1200px) {
		/* Widen the fixed sidebar again */
		.dashboard-sidebar.affix-bottom,
		.dashboard-sidebar.affix {
			width: 263px;
		}
	}
	</style>
	
	<!-- you can set your netdata server globally, by ucommenting this -->
	<!-- you can also give a different server per chart, with the attribute: data-host="http://netdata.server:19999" -->
	<!-- <script> netdataServer = "http://box:19999"; </script> -->

	<!-- load the dashboard manager - it will do the rest -->
	<script type="text/javascript" src="dashboard.js"></script>
</head>
<body data-spy="scroll">
	<nav class="navbar navbar-default navbar-fixed-top" role="banner">
		<div class="container">
			<div class="navbar-header">
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a href="/" class="navbar-brand">Netdata</a>
			</div>
<!--			<nav class="collapse navbar-collapse" role="navigation">
				<ul class="nav navbar-nav">
					<li><a href="#sec">Get Started</a></li>
					<li><a href="#sec">Edit</a></li>
					<li><a href="#sec">Visualize</a></li>
					<li><a href="#sec">Prototype</a></li>
				</ul>
			</nav>
-->		</div>
	</nav>

	<div id="masthead"> 
		<div class="container">
			<div class="row">
				<div class="col-md-7">
					<h1>Netdata Dashboard
						<p class="lead">Real time data collection and graphs...</p>
					</h1>
				</div>
				<div class="col-md-5">
					<div class="well well-lg">
						<div class="row">
						<div class="col-md-6">
							<b>Drag</b> charts to pan.
							<b>Shift + wheel</b> on them, to zoom in and out.
							<b>Double-click</b> on them, to reset.
							<b>Hover</b> on them too!
							</div>
						<div class="col-md-6">
							<div data-netdata="system.intr" data-chart-library="dygraph" data-dygraph-theme="sparkline" data-dygraph-type="line" data-dygraph-strokewidth="3" data-dygraph-smooth="true" data-dygraph-highlightcirclesize="6" data-after="-40" data-height="60px" data-colors="#C66"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<div class="row">
			<div class="col-md-10" role="main">
				<div class="alert alert-info" role="alert">
					<p>
					<h4><b>Welcome to netdata!</b></h4>
					</p><p>
					<b><a href="https://github.com/firehol/netdata/" target="_blank">Netdata</a></b> is the fastest way to visualize data. It is a resource efficient, highly optimized system for collecting and visualizing any type of timeseries data.
					</p><p>
					To make a chart in <b><a href="https://github.com/firehol/netdata/" target="_blank">Netdata</a></b>, you just need a <b>counter</b>. Just a number you can read again and again. Netdata will turn such a number to a real time chart. For collecting these numbers, it supports <a href="https://github.com/firehol/netdata/tree/master/plugins.d" target="_blank">external plugins</a>, even <a href="https://github.com/firehol/netdata/tree/master/charts.d" target="_blank">bash plugins</a>. Any computer program, in any language, that can print just a few lines of text on its standard output, can be a netdata collector.
					</p><p>
					<b><a href="https://github.com/firehol/netdata/" target="_blank">Netdata</a></b> can embed charts in any web page. You can have its charts on your site too. Just give it a <code>div</code> and a real time chart, zoomable and draggable will appear (don't be afraid of its performance - a raspberry pi 2 can easily serve 500 charts updates per second!).
					</p><p>
					If you like this project, we need help writing documentation, coding plugins, testing new features, supporting end users...
					<br/>
					If you have some time to spare, we will be glad to have you on board...
					</p>
				</div>
				<div id="charts_div"></div>
			</div>
			<div class="col-md-2" role="complementary">
				<nav class="dashboard-sidebar hidden-print hidden-xs hidden-sm" data-spy="affix" id="sidebar" role="menu"></nav>
			</div>
		</div>
	</div>

</body>
</html>
<script>

var options = {
	sparklines_registry: {},
	data: null,
	hostnane: 'netdata_server', // will be overwritten by the netdata server
	categories: new Array(),
	categories_idx: {},
	families: new Array(),
	families_idx: {},

	chartsPerRow: 0,
	chartsMinWidth: 1450,
	chartsHeight: 180,
	sparklinesHeight: 60
};

// generate a sparkline
// used in the documentation
function sparkline(chart, dimension, units) {
	var key = chart + '.' + dimension;

	if(typeof units === 'undefined')
		units = '';

	if(typeof options.sparklines_registry[key] === 'undefined')
		options.sparklines_registry[key] = { count: 1 };
	else
		options.sparklines_registry[key].count++;

	key = key + '.' + options.sparklines_registry[key].count;

	var h = '<div data-netdata="' + chart + '" data-after="-120" data-width="25%" data-height="15px" data-chart-library="dygraph" data-dygraph-theme="sparkline" data-dimensions="' + dimension + '" data-show-value-of-' + dimension + '-at="' + key + '"></div> (<span id="' + key + '" style="display: inline-block; min-width: 50px; text-align: right;">X</span>' + units + ')';

	return h;
}

// documentation for each category and chart
var messages = {

	// categories / sections
	'system': 'Overview of the key system metrices.',
	'tc': 'Netdata collects and visualizes tc class utilization using its <a href="https://github.com/firehol/netdata/blob/master/plugins.d/tc-qos-helper.sh" target="_blank">tc-helper plugin</a>. If you also use <a href="http://firehol.org/#fireqos" target="_blank">FireQOS</a> for setting up QoS, netdata automatically collects interface and class names.',
	'net': 'Per network interface statistics collected from <code>/proc/net/dev</code>.',
	'apps': 'Per application statistics are collected using netdata\'s <code>apps.plugin</code>. This plugin walks through the entire <code>/proc</code> filesystem and aggregates statistics for applications of interest, defined in <code>/etc/netdata/apps_groups.conf</code> (the default is <a href="https://github.com/firehol/netdata/blob/master/conf.d/apps_groups.conf" target="_blank">here</a>). The plugin internaly builds a process tree (much like <code>ps fax</code> does), and groups processes together (evaluating both child and parent processes) so that the result is always a chart with a predefined set of dimensions (of course, only application groups found running are reported).<br/><b>IMPORTANT</b>: The values shown here are not 100% accurate. They only include values for the processes running. If an application is spawning childs continiously, which are terminated in just a few milliseconds (like shell scripts do), the values reported will be inaccurate. Linux does report the values for the exited childs of a process. However, these values are reported to the parent process <b>only when the child exits</b>. If these values, of the exited child processes, were also aggregated in the charts below, the charts would have been full of spikes, presenting unrealisting utilization for each process group. So, we decided to ignore these values and present only the utilization of <b>the currently running processes</b>.',

	// charts
	'system.cpu': 'Total CPU utilization (all cores). 100% here means there is no CPU idle time at all. You can get per core usage at the <a href="#cpu">CPUs</a> section and per application usage at the <a href="#apps">Applications Monitoring</a> section.<br/>Keep an eye on <b>iowait</b> ' + sparkline('system.cpu', 'iowait', '%') + '. If it is constantly high, your disks are a bottleneck and they slow your system down.<br/>Another important metric worth monitoring, is <b>softirq</b> ' + sparkline('system.cpu', 'softirq', '%') + '. A constantly high percentage of softirq may indicate network drivers issues.',
	'system.io': 'Total Disk I/O, for all disks, read from <code>/proc/vmstat</code>. You can get detailed information about each disk at the <a href="#disk">Disks</a> section and per application Disk usage at the <a href="#apps">Applications Monitoring</a> section.',
	'system.swapio': 'Total Swap I/O, read from <code>/proc/vmstat</code>. (netdata measures both <code>in</code> and <code>out</code>. If either of them is not shown in the chart, it is because it is zero - you can change the page settings to always render all the available dimensions on all charts).',
	'system.pgfaults': 'Total page faults, read from <code>/proc/vmstat</code>. <b>Major page faults</b> indicates that the system is using its swap. You can find which applications use the swap at the <a href="#apps">Applications Monitoring</a> section.',
	'system.entropy': '<a href="https://en.wikipedia.org/wiki/Entropy_(computing)" target="_blank">Entropy</a>, read from <code>/proc/sys/kernel/random/entropy_avail</code>, is like a pool of random numbers that are mainly used in cryptography. It is advised that the pool remains always <a href="https://blog.cloudflare.com/ensuring-randomness-with-linuxs-random-number-generator/" target="_blank">above 200</a>. If the pool of entropy gets empty, you risk your security to be predictable and you should install a user-space random numbers generating daemon, like <a href="http://www.issihosts.com/haveged/" target="_blank">haveged</a>, to keep the pool in healthy levels.',
	'system.forks': 'The number of new processes created per second, read from <code>/proc/stat</code>.',
	'system.intr': 'Total number of CPU interrupts, read from <code>/proc/stat</code>. Check <code>system.interrupts</code> that gives more detail about each interrupt and also the <a href="#cpu">CPUs</a> section where interrupts are analyzed per CPU core.',
	'system.interrupts': 'CPU interrupts in detail, read from <code>/proc/interrupts</code>. At the <a href="#cpu">CPUs</a> section, interrupts are analyzed per CPU core.',
	'system.processes': 'System processes, read from <code>/proc/stat</code>. <b>Blocked</b> are processes that are willing to execute but they cannot, e.g. because they wait for disk activity.',
	'system.ctxt': '<a href="https://en.wikipedia.org/wiki/Context_switch" target="_blank">Context Switches</a>, read from <code>/proc/stat</code>, is the switching of the CPU from one process, task or thread to another. If there are many processes or threads willing to execute and very few CPU cores available to handle them, the system is making more context switching to balance the CPU resources among them. The whole process is computationally intensive. The more the context switches, the slower the system gets.',
	'system.idlejitter': 'Idle jitter is calculated by netdata. A thread is spawned that requests to sleep for a few microseconds. When the system wakes it up, it measures how many microseconds have passed. The different between the requested and the actual duration of the sleep, is the <b>idle jitter</b>. This number is useful in realtime environments, where CPU jitter can affect the quality of the service (like VoIP media gateways).',
	'system.ipv4': 'Total IPv4 Traffic, read from <code>/proc/net/netstat</code>. This includes <code>lo</code> device traffic.',
	'system.ram': 'System memory, read from <code>/proc/meminfo</code>.',
	'system.swap': 'System swap memory, read from <code>/proc/meminfo</code>.',

	// just a line to allow ending all entries above with comma
	'end': 'end'
};

function screenWidth() {
	return (($(window).width() * 0.95) - 50);
}

function chartsPerRow(total) {
	if(options.chartsPerRow === 0) {
		width = Math.floor(total / options.chartsMinWidth);
		if(width === 0) width = 1;
		return width;
	}
	else return options.chartsPerRow;
}

function chartsPrioritySort(a, b) {
	if(a.priority === b.priority) {
		if(a.name < b.name) return -1;
	}
	else if(a.priority < b.priority) return -1;
	return 1;
}

function uniq(array, find_key, get_result) {
	if(typeof get_result === 'undefined' || get_result === null)
		get_result = find_key;

	var idx = {};
	var result = new Array();

	$.each(array, function(i, c) {
		key = find_key(c);
		if(typeof idx[key] === 'undefined') {
			idx[key] = true;
			result.push(get_result(c));
		}
	});
	return result;
}

function uniq_with_list(array, find_key_function) {
	var idx = {};
	var result = new Array();

	$.each(array, function(i, c) {
		key = find_key_function(c);
		if(typeof idx[key] === 'undefined') {
			idx[key] = new Array();
			result.push( { name: key, values: idx[key] } );
		}
		idx[key].push(c);
	});
	result.sort(function(a, b) {
		if(a.name < b.name) return -1;
		return 1;
	});
	return result;
}

function prepareScreen(data) {
	// console.log('NETDATA is paused - ready to prepare the screen');
	// console.log(data);

	options.data = data;
	options.hostname = data.hostname;
	var charts = data.charts;

	$.each(charts, function(i, c) {
		if(c.enabled === true) {

			// find the category of the chart
			c.category = c.type.split('.')[0];

			var tmp = c.category.split('_')[0];
			if(tmp === 'net' || tmp === 'disk')
				c.category = tmp;

			switch(c.category) {
				case 'system':
					c.category_priority = 10;
					c.category_title = 'System Summary';
					c.glyphicon = "glyphicon-dashboard";
					break;

				case 'tc':
					c.category_priority = 20;
					c.category_title = 'Quality Of Service';
					c.glyphicon = "glyphicon-random";
					break;

				case 'net':
					c.category_priority = 30;
					c.category_title = 'Network Interfaces';
					c.glyphicon = "glyphicon-transfer";
					break;

				case 'apps':
					c.category_priority = 40;
					c.category_title = 'Applications Monitoring';
					c.glyphicon = "glyphicon-tasks";
					break;

				case 'ipvs':
					c.category_priority = 50;
					c.category_title = 'IP Virtual Server';
					c.glyphicon = "glyphicon-transfer";
					break;

				case 'netfilter':
					c.category_priority = 60;
					c.category_title = 'Netfilter / IPTables';
					c.glyphicon = "glyphicon-cloud";
					break;

				case 'ipv4':
					c.category_priority = 70;
					c.category_title = 'IPv4 Summary';
					c.glyphicon = "glyphicon-globe";
					break;

				case 'mem':
					c.category_priority = 80;
					c.category_title = 'Memory';
					c.glyphicon = "glyphicon-dashboard";
					break;

				case 'cpu':
					c.category_priority = 90;
					c.category_title = 'CPUs';
					c.glyphicon = "glyphicon-dashboard";
					break;

				case 'disk':
					c.category_priority = 100;
					c.category_title = 'Disks';
					c.glyphicon = "glyphicon-hdd";
					break;

				case 'nfsd':
					c.category_priority = 110;
					c.category_title = 'NFS Server';
					c.glyphicon = "glyphicon-hdd";
					break;

				case 'squid':
					c.category_priority = 140;
					c.category_title = 'Proxy Server';
					c.glyphicon = "glyphicon-link";
					break;

				case 'netdata':
					c.category_priority = 150;
					c.category_title = 'Netdata Monitoring';
					c.glyphicon = "glyphicon-thumbs-up";
					break;

				case 'sensors':
					c.category_priority = 160;
					c.category_title = 'Hardware Sensors';
					c.glyphicon = "glyphicon-thumbs-up";
					break;

				case 'postfix':
					c.category_priority = 170;
					c.category_title = 'Mail Server';
					c.glyphicon = "glyphicon-thumbs-up";
					break;

				case 'example':
					c.category_priority = 100000;
					c.category_title = 'Example Plugins';
					c.glyphicon = "glyphicon-search";
					break;

				default:
					c.category_priority = 150;
					c.category_title = c.type;
					c.glyphicon = "glyphicon-dashboard";
					break;
			}

			// find the unique categories
			if(typeof options.categories_idx[c.category] === 'undefined') {
				options.categories_idx[c.category] = {
					charts: new Array()
				}
				options.categories.push({
					name: c.category,
					title: c.category_title,
					priority: c.category_priority,
					glyphicon: c.glyphicon,
					charts: options.categories_idx[c.category].charts
				});
			}
			options.categories_idx[c.category].charts.push(c);

			// find the unique families
			if(typeof options.families_idx[c.family] === 'undefined') {
				options.families_idx[c.family] = {
					charts: new Array()
				};
				options.families.push({
					name: c.family,
					title: c.family,
					priority: c.category_priority,
					glyphicon: c.glyphicon,
					charts: options.categories_idx[c.category].charts
				});
			}
			options.families_idx[c.family].charts.push(c);
		}
	});

	function prioritySort(a, b) {
		if(a.priority < b.priority) return -1;
		if(a.priority > b.priority) return 1;
		if(a.name < b.name) return -1;
		return 1;
	}

	// sort all of them
	options.categories.sort(prioritySort);
	options.families.sort(prioritySort);
	$.each(options.families,   function(i, c) { c.charts.sort(prioritySort); });

	var div = document.getElementById('charts_div');
	var pcent_width = Math.floor(100 / chartsPerRow($(div).width()));

	// find the proper duration for per-second updates
	var duration = Math.round(($(div).width() * pcent_width / 100 * data.update_every / 3) / 60) * 60;
	var html = '';
	var sidebar = '<ul class="nav dashboard-sidenav" id="sidebar_ul">';

	function getMessage(id) {
		if(typeof messages[id] !== 'undefined')
			return '<div class="chart-message" role="document">' + messages[id] + '</div>';
		else
			return '';
	}

	// render the charts
	$.each(options.categories, function(i, t) {
		t.charts.sort(prioritySort);

		sidebar += '<li class="' + ((i === 0)?'active':'').toString() + '"><a href="#' + t.name + '">' + t.title + '</a>';
		html += '<div role="section"><div role="sectionhead"><h1 id="' + t.name + '" role="heading">' + t.title + '</h1>' + getMessage(t.name) + '</div><div id="' + t.name + '" role="document">';

		if(t.name === 'net' || t.name === 'tc') {
			var interfaces = uniq_with_list(t.charts, function(c) { return c.family; });

			sidebar += '<ul class="nav">';
			$.each(interfaces, function(j, c) {
				sidebar += '<li class><a href="#' + t.name + '_' + c.name + '">' + c.name + '</a></li>';
				html += '<div class="netdata-group-container" id="interface_' + t.name + '_' + c.name + '" style="display: inline-block; width: ' + pcent_width.toString() + '%"><h2 id="' + t.name + '_' + c.name + '" class="netdata-chart-alignment" role="heading">' + c.name + '</h2>';
				$.each(c.values, function(x, f) {
					var c = null;
					var h = options.chartsHeight / 2;
					switch(f.type) {
						case 'net'        : h = options.chartsHeight; break;
						case 'tc'         : h = options.chartsHeight; break;
					}

					html += getMessage(f.id) + '<div data-netdata="' + f.id + '"'
						+ ' data-width="100%"'
						+ ' data-height="' + h.toString() + 'px"'
						+ ' data-before="0"'
						+ ' data-after="-' + duration.toString() + '"'
						+ ' data-colors="' + c + '"'
						+ ' role="application"></div>';
				});
				html += '</div>'; // netdata-group-container
			});
			sidebar += '</ul>';
		}
		else if(t.name === 'disk') {
			var disks = uniq_with_list(t.charts, function(c) { return c.family; });

			sidebar += '<ul class="nav">';
			$.each(disks, function(j, c) {
				sidebar += '<li class><a href="#' + c.name + '">' + c.name + '</a></li>';
				html += '<div class="netdata-group-container" id="disk_' + c.name + '" style="display: inline-block; width: ' + pcent_width.toString() + '%"><h2 id="' + c.name + '" class="netdata-chart-alignment" role="heading">' + c.name + '</h2>';
				$.each(c.values, function(x, f) {
					var c = null;
					var h = options.chartsHeight / 2;
					switch(f.type) {
						case 'disk'        : h = options.chartsHeight; break;
						case 'disk_backlog': c = '#DD4477'; break;
						case 'disk_util'   : c = '#109618'; break;
						case 'disk_qops'   : c = '#E67300'; break;
					}

					html += getMessage(f.id) + '<div data-netdata="' + f.id + '"'
						+ ' data-width="100%"'
						+ ' data-height="' + h.toString() + 'px"'
						+ ' data-before="0"'
						+ ' data-after="-' + duration.toString() + '"'
						+ ' data-colors="' + c + '"'
						+ ' role="application"></div>';
				});
				html += '</div>'; // netdata-group-container
			});
			sidebar += '</ul>';
		}
		else if(t.name === 'apps') {
			$.each(t.charts, function(x, f) {
				var c = null;
				var h = options.chartsHeight / 2;
				switch(f.id) {
					case 'apps.cpu'         : h = options.chartsHeight; break;
					case 'apps.preads'      : h = options.chartsHeight; break;
					case 'apps.pwrites'     : h = options.chartsHeight; break;
					case 'apps.mem'         : h = options.chartsHeight; break;
					case 'apps.major_faults': h = options.chartsHeight; break;
				}

				html += getMessage(f.id) + '<div data-netdata="' + f.id + '"'
					+ ' data-width="100%"'
					+ ' data-height="' + h.toString() + 'px"'
					+ ' data-before="0"'
					+ ' data-after="-' + duration.toString() + '"'
					+ ' data-colors="' + c + '"'
					+ ' role="application"></div>';
			});
		}
		else {
			$.each(t.charts, function(x, c) {
				html += getMessage(c.id) + '<div data-netdata="' + c.id + '"'
					+ ' data-width="' + pcent_width.toString() + '%"'
					+ ' data-height="' + options.chartsHeight.toString() + 'px"'
					+ ' data-before="0"'
					+ ' data-after="-' + duration.toString() + '"'
					+ ' role="application"></div>';
			});
		}

		sidebar += '</li>';
		html += '</div>'; // document
		html += '</div>'; // section
		html += '<hr role="separator"/>';
	});
	sidebar += '</ul>';
/*
	// show the colors
	html += '<br/><div class="row">'
	$.each(NETDATA.colors, function(i, c){
		html += '<div style="display: inline-block;"><div style="display: inline-block; width: 100px; height: 100px; background: ' + c + ';"></div><br/>' + c + '</div>';
	});
	html += '</div>'
*/
	div.innerHTML = html;
	document.getElementById('sidebar').innerHTML = sidebar;

	// resize all charts - without starting the background thread
	// this has to be done while NETDATA is paused
	// if we ommit this, the affix menu will be wrong, since all
	// the Dom elements are initially zero-sized
	NETDATA.parseDom();

	// let it run (update the charts)
	NETDATA.unpause();

	// check if we have to jump to a specific section
	var hash = location.hash.replace('#','');
	if(hash != '') {
		// Clear the hash in the URL
		// location.hash = '';   // delete front "//" if you want to change the address bar
		var offset = $(location.hash).offset();
		if(typeof offset !== 'undefined')
			$('html, body').animate({ scrollTop: offset.top }, 0);
	}

	/* activate bootstrap scrollspy (needed for sidebar) */
	$(document.body).scrollspy({
		target: '#sidebar',
		offset: $(window).height() / 3 // controls the diff of the <hX> element to the top, to select it
	});

	/* activate bootstrap sidebar (affix) */
	$('#sidebar').affix({
		offset: {
			top: 200,
			bottom: 0
		}
	});

	/* fix scrolling of very long affix lists
	   http://stackoverflow.com/questions/21691585/bootstrap-3-1-0-affix-too-long
	 */
	$('#sidebar').on('affixed.bs.affix', function() {
		$(this).removeAttr('style');
	});
}

NETDATA.ready(function() {

	// download all the charts the server knows
	NETDATA.chartRegistry.downloadAll(NETDATA.serverDefault, function(data) {

		// pause the NETDATA thread that updates the charts
		NETDATA.pause(function() {

			// prepare our DOM
			// this will be called when NETDATA is paused
			prepareScreen(data);
		});
	});
});
</script>
